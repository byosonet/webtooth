{% extends "extends.html" %}

{% block title %} Datos del paciente {%endblock%}
{% block titlepage %} N&uacute;mero de expediente {% if delPatient %}<i class="fas fa-trash"></i>{% else %}<i class="fas fa-check-circle"></i>{% endif %}<div style="text-align: center;"><hr style="margin: 5 auto;"><b>{{ expediente }}</b></div> {%endblock%}

{% block body %}

{% if form %}

{% if form.errors %}
{% for field in form %}
{% if field.errors %}
<strong style="color:red;">{{ field.errors }}</strong>
{% endif %}
{% endfor %}
{% endif %}

{% if formAdress.errors %}
{% for field in formAdress %}
{% if field.errors %}
<strong style="color:red;">{{ field.errors }}</strong>
{% endif %}
{% endfor %}
{% endif %}

<nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active text-{{request.session.bt_color}}" id="nav-register-tab" data-toggle="tab" href="#datos-registro" role="tab"
            aria-controls="nav-home" aria-selected="true"><i class="fas fa-user fa-1x"></i> Datos personales</a>
        <a class="nav-item nav-link text-{{request.session.bt_color}}" id="nav-help-tab" data-toggle="tab" href="#ayuda" role="tab"
            aria-controls="nav-profile" aria-selected="false"><i class="fas fa-notes-medical fa-1x"></i> Datos cl&iacute;nicos</a>
    </div>
</nav>
<div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="datos-registro" role="tabpanel" aria-labelledby="nav-register-tab">
        <div style="margin-top: 20px; width: 98%; margin-left: 5px;margin-right: 20px;">

            <form class="user" action="{% url 'actualizarPaciente' id %}" method="POST" enctype="multipart/form-data">{% csrf_token %}

                <div class="form-group row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-2">
                        <div class="input-group">
                            {{form.fechaNacimiento}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fa fa-birthday-cake"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-2">
                        <div class="input-group">
                            <input type="text" name="edad" class="form-control form-control-user"
                                placeholder="Edad" data-placement="top" data-trigger="hover" rel="popover"
                                data-original-title="Edad aproximada" data-content="Edad aproximada" id="edad" 
                                readonly>
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fa fa-id-card"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-2">
                        <div class="input-group">
                            {{form.fechaAlta}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-calendar-alt"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-2">
                        <div class="input-group">
                            {{form.fechaUpdate}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-calendar-alt"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
              

                <div class="form-group row">
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{form.nombre}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-keyboard"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{form.apellidoPaterno}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-keyboard"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{form.apellidoMaterno}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-keyboard"></i></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{form.rfc}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-keyboard"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{form.email}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-envelope"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{form.telefono}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-phone"></i></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{formAdress.calle}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-map-marked-alt"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{formAdress.numeroExt}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-map-marked-alt"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{formAdress.numeroInt}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-map-marked-alt"></i></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{formAdress.cp}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fab fa-usps"></i></div>
                            </div>
                        </div>
                    </div>
                </br></br>
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{formAdress.ciudad}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-city"></i></div>
                            </div>
                        </div>
                    </div>
                    </br></br>
                    <div class="col-sm-2">
                        {{formAdress.estado}}
                    </div>
                </br></br>
                    <div class="col-sm-2">
                        {{form.sexo}}
                    </div>
                </div>

                <div class="form-group row">
                    <div class="col-sm-4">
                        <div class="input-group">
                            {{form.ocupacion}}
                            <div class="input-group-append">
                                <div class="input-group-text"><i class="fas fa-chalkboard-teacher"></i></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2">
                        
                    </div>
                </div>
                <br>
                <div class="form-group row">
                    <div class="col-sm-9">
                        Foto del paciente:
                        {% if form.foto.value and not delPatient %}
                        <a target="_blank" href="{{ form.foto.value.url }}"><img style="height: 50px;border-radius: 55px;" src="{{form.foto.value.url}}" /></a>
                        </br></br>
                        {% else %}
                        <i class="fas fa-user fa-2x text-gray-300"></i>
                        {% endif %}
                        {{form.foto}}
                    </br></br>
                    </div>
                    
                    <div class="col-sm-3">
                        {% if not delPatient %}
                        <div style="float: right;">
                            {{form.activo}}
                            {% if form.activo.value %}
                            <span class="btn btn-success btn-sm" style="font-size: 14px;"> Desactivar (Baja temporal) </span>
                            {% else %}
                            <span class="btn btn-warning btn-sm" style="font-size: 14px;"> Activar (Servicio paciente)</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if not delPatient %}
                <div class="form-group row">

                    <div class="col-sm-4">
                        {{form.numexp}}
                    </div>
                    <div class="col-sm-2">
                        
                        <button {% if not form.email.value %}disabled{% endif %} id="enviarRecetaButton" type="button" class="btn btn-danger btn-user btn-block" href="#" data-toggle="modal"
                            data-target="#enviarRecetaModal" role="button"><i class="fa fa-pen"></i> Enviar receta</button>
                        
                    </div>
                    </br></br>
                    <div class="col-sm-2">
                        <button id="modbutton" type="button" class="btn btn-danger btn-user btn-block" href="#" data-toggle="modal"
                            data-target="#modifyModal" role="button"><i class="fa fa-pen"></i> Modificar</button>
                    </div>
                    </br></br>
                    <div class="col-sm-2">
                        <button id="delbutton" type="button" class="btn btn-danger btn-user btn-block" href="#" data-toggle="modal"
                            data-target="#deleteModal" role="button"><i class="fa fa-trash"></i> Eliminar</button>
                    </div>
                    </br></br>
                    <div class="col-sm-2">
                        <button id="update" disabled type="submit"
                            class="btn btn-{{request.session.bt_color}} btn-user btn-block"><i class="fa fa-check"></i>
                            Actualizar</button>
                    </div>
                </div>
                {% endif %}
            </form>

            <!-- Logout eliminar-->
            <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><i class="fas fa-info-circle fa-1x"></i> Aviso de sistema</h5>
                        </div>
                        <div class="modal-body" style="text-align: justify;">¿Est&aacute; seguro de eliminar el registro actual que contiene los
                            siguientes datos? </br></br>Nombre: <b>{{form.nombre.value}} {{form.apellidoPaterno.value}}
                            {{form.apellidoMaterno.value}}</b></br>Correo: <b>{{form.email.value}}</b></br></br><b>Nota: Los datos ser&aacute;n bloqueados en sistema una vez eliminado el registro.</b></div>
                        <div class="modal-footer">
                            <button class="btn btn-{{request.session.bt_color}}" type="button"
                                data-dismiss="modal" style="border-radius: 10rem;"><i class="fas fa-times"></i> Cancelar</button>
                            <a class="btn btn-{{request.session.bt_color}}"
                                href="{% url 'eliminarPaciente' id %}" style="border-radius: 10rem;"><i class="fas fa-check"></i> Aceptar</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logout modificar-->
            <div class="modal fade" id="modifyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><i class="fas fa-info-circle fa-1x"></i> Aviso de sistema</h5>
                        </div>
                        <div class="modal-body">¿Est&aacute; seguro de modificar el registro actual que contiene los
                            siguientes
                            datos? </br></br>Nombre: <b>{{form.nombre.value}} {{form.apellidoPaterno.value}}
                            {{form.apellidoMaterno.value}}</b></br>Correo: <b>{{form.email.value}}</b></div>
                        <div class="modal-footer">
                            <button class="btn btn-{{request.session.bt_color}}" type="button"
                                data-dismiss="modal" style="border-radius: 10rem;"><i class="fas fa-times"></i> Cancelar</button>
                            <button id="modidy" class="btn btn-{{request.session.bt_color}}" type="button"
                                data-dismiss="modal" style="border-radius: 10rem;"><i class="fas fa-check"></i> Aceptar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logout correo-->
            <div class="modal fade" id="enviarRecetaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"><i class="fas fa-info-circle fa-1x"></i> Aviso de sistema
                            </h5>
                        </div>
                        <div class="modal-body" style="text-align: justify;">Estos son los datos del paciente a utilizar para el env&iacute;o de 
                            la receta, 
                            ¿Son correcto los datos? </br></br>Nombre: <b>{{form.nombre.value}} {{form.apellidoPaterno.value}}
                                {{form.apellidoMaterno.value}}</b></br>Correo: <b>{{form.email.value}}</b></br></br></div>
                        <div class="modal-footer">
                            <button class="btn btn-{{request.session.bt_color}}" type="button" data-dismiss="modal"
                                style="border-radius: 10rem;"><i class="fas fa-times"></i> Cancelar</button>
                            <a class="btn btn-{{request.session.bt_color}}" href="{% url 'emailPatient' id %}"
                                style="border-radius: 10rem;"><i class="fas fa-check"></i> Aceptar</a>
                        </div>
                    </div>
                </div>
            </div>



        </div>
    </div>

    <div class="tab-pane fade" id="ayuda" role="tabpanel" aria-labelledby="nav-help-tab">
        <div style="margin-top: 20px; width: 98%; margin-left: 10px;margin-right: 20px;">

            <p style="text-align: justify;">
                Desde este apartado podr&aacute;s visualizar los datos cl&iacute;nicos del paciente.
            </p>

        </div>
    </div>

</div>

{% load static %}
<script src="{% static 'js/jquery.min.js' %}"></script>
<script>
    $(function () {
        $("input[name='telefono']").on('input', function (e) {
            $(this).val($(this).val().replace(/[^0-9]/g, ''));
        });

        $("input[name='cp']").on('input', function (e) {
            $(this).val($(this).val().replace(/[^0-9]/g, ''));
        });

        $("#id_nombre").prop("readonly", true);
        $("#id_apellidoPaterno").prop("readonly", true);
        $("#id_apellidoMaterno").prop("readonly", true);
        $("#id_rfc").prop("readonly", true);
        $("#id_email").prop("readonly", true);
        $("#id_telefono").prop("readonly", true);
        $("#id_calle").prop("readonly", true);
        $("#id_numeroExt").prop("readonly", true);
        $("#id_numeroInt").prop("readonly", true);
        $("#id_cp").prop("readonly", true);
        $("#id_ciudad").prop("readonly", true);
        $("#id_estado").prop("disabled", true);
        $("#id_sexo").prop("disabled", true);
        $("#id_foto").prop("readonly", true);
        $("#id_activo").prop("readonly", true);
        $("#update").prop("disabled", true);
        $("#id_ocupacion").prop("readonly", true);
        $("#id_fechaNacimiento").prop("readonly", true);
        $("#id_foto").prop("disabled", true);

        $("#id_fechaAlta").prop("disabled", '');
        $("#id_fechaUpdate").prop("disabled", '');
        
        $("#modidy").click(function () {
            $("#modbutton").prop("disabled", true);
            $("#delbutton").prop("disabled", true);
            $("#enviarRecetaButton").prop("disabled", true);
            $("#id_nombre").prop("readonly", false);
            $("#id_apellidoPaterno").prop("readonly", false);
            $("#id_apellidoMaterno").prop("readonly", false);
            $("#id_rfc").prop("readonly", false);
            $("#id_email").prop("readonly", false);
            $("#id_telefono").prop("readonly", false);
            $("#id_calle").prop("readonly", false);
            $("#id_numeroExt").prop("readonly", false);
            $("#id_numeroInt").prop("readonly", false);
            $("#id_cp").prop("readonly", false);
            $("#id_ciudad").prop("readonly", false);
            $("#id_estado").prop("disabled", false);
            $("#id_sexo").prop("disabled", false);
            $("#id_foto").prop("readonly", false);
            $("#id_activo").prop("readonly", false);
            $("#update").prop("disabled", false);
            $("#id_ocupacion").prop("readonly", false);
            $("#id_fechaNacimiento").prop("readonly", false);
            $("#id_foto").prop("disabled", false);
            
            /*$("#id_estado").select2({});
            $("#id_sexo").select2({});*/
            
        });
        
        $('#edad').val(age($("#id_fechaNacimiento").val()))
    });
</script>

{% else %}
    <div class="card-header py-3">
        <h6 style="text-align: center;" class="m-0 font-weight-bold text-{{request.session.bt_color}}"> <i class="fas fa-info-circle"></i> No existe ning&uacute;n registro con los datos recibidos</h6>
    </div>
    </br>
    <div class="col-sm-2" style="margin: 0 auto;text-align: center;">
        <a style="border-radius: 10rem;" class="btn btn-{{request.session.bt_color}}" href="{% url 'listarPaciente' %}" role="button"><i class="fa fa-arrow-left"></i> Regresar</a>
    </div>
{% endif %}
{% endblock %}